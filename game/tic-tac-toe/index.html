<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe AI</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #ecf0f1;
            --text-color: #34495e;
            --border-color: #bdc3c7;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--background-color);
            font-family: Arial, sans-serif;
            color: var(--text-color);
            user-select: none;
        }

        .container {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .cell {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            background-color: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cell:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .cell:active {
            transform: scale(0.95);
        }

        #difficulty {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        #result {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            min-height: 30px;
        }

        @media (max-width: 480px) {
            .container {
                width: 90%;
                padding: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .cell {
                font-size: 1.5rem;
            }

            #difficulty, #result {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Tic-Tac-Toe AI</h1>
    <div id="difficulty">Difficulty: <span id="difficultyLevel"></span></div>
    <div id="gameBoard"></div>
    <div id="result"></div>
</div>

<script>
    // todo needs fixing. the ai recognize its win
    const board = [
        ['', '', ''],
        ['', '', ''],
        ['', '', '']
    ];
    let currentPlayer = 'X';
    let aiDifficulty = getRandomDifficulty();
    let gameActive = true;

    const gameBoard = document.getElementById('gameBoard');
    const resultDisplay = document.getElementById('result');
    const difficultyDisplay = document.getElementById('difficultyLevel');

    const androidInterfaceExists = typeof AndroidInterface !== 'undefined';
    function createBoard() {
        gameBoard.innerHTML = '';
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.addEventListener('click', handleCellClick);
                gameBoard.appendChild(cell);
            }
        }
        updateDifficultyDisplay();
    }

    function updateDifficultyDisplay() {
        difficultyDisplay.textContent = aiDifficulty.charAt(0).toUpperCase() + aiDifficulty.slice(1);
    }

    function handleCellClick(event) {
        if (!gameActive) return;
        const row = event.target.dataset.row;
        const col = event.target.dataset.col;

        if (board[row][col] === '' && currentPlayer === 'X') {
            board[row][col] = 'X';
            event.target.textContent = 'X';

            if (checkWin('X')) {
                endGame('You win!');
            } else if (checkTie()) {
                endGame('It\'s a tie!');
            } else {
                currentPlayer = 'O';
                setTimeout(aiMove, 500);
            }
        }
    }

    function aiMove() {
        if (!gameActive) return;
        if (aiDifficulty === 'easy') {
            randomMove();
        } else if (aiDifficulty === 'medium') {
            if (!blockPlayer()) {
                randomMove();
            }
        } else {
            perfectMove();
        }
    }

    function randomMove() {
        const availableMoves = getAvailableMoves();
        if (availableMoves.length > 0) {
            const randomIndex = Math.floor(Math.random() * availableMoves.length);
            const [row, col] = availableMoves[randomIndex];
            board[row][col] = 'O';
            gameBoard.children[row * 3 + col].textContent = 'O';

            if (checkWin('O')) {
                endGame('AI wins!');
                sendGameUpdate("Ai wins!");
            } else if (checkTie()) {
                endGame('It\'s a tie!');
                sendGameUpdate("Tie!");
            } else {
                currentPlayer = 'X';
            }
            
        }
    }

    function blockPlayer() {
        // Logic to block player's potential winning move
        // Example implementation
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[i][j] === '') {
                    board[i][j] = 'X'; // Temporarily set to X
                    if (checkWin('X')) {
                        board[i][j] = 'O'; // Block with O
                        gameBoard.children[i * 3 + j].textContent = 'O';
                        currentPlayer = 'X';
                        return true;
                    }
                    board[i][j] = ''; // Reset
                }
            }
        }
        return false;
    }

    function perfectMove() {
        // Logic for AI's perfect move using minimax or a similar strategy
        // Example implementation could be added here
        randomMove(); // Fallback to random for now
    }

    function getAvailableMoves() {
        const moves = [];
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[i][j] === '') {
                    moves.push([i, j]);
                }
            }
        }
        return moves;
    }

    function checkWin(player) {
        for (let i = 0; i < 3; i++) {
            if (board[i][0] === player && board[i][1] === player && board[i][2] === player) return true;
            if (board[0][i] === player && board[1][i] === player && board[2][i] === player) return true;
        }
        if (board[0][0] === player && board[1][1] === player && board[2][2] === player) return true;
        if (board[0][2] === player && board[1][1] === player && board[2][0] === player) return true;
        return false;
    }

    function checkTie() {
        return board.flat().every(cell => cell !== '');
    }

    function endGame(message) {
        gameActive = false;
        resultDisplay.textContent = message;
        setTimeout(resetGame, 2000);
    }

    function resetGame() {
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                board[i][j] = '';
                gameBoard.children[i * 3 + j].textContent = '';
            }
        }
        currentPlayer = 'X';
        aiDifficulty = getRandomDifficulty();
        gameActive = true;
        resultDisplay.textContent = '';
        updateDifficultyDisplay();
    }

    function getRandomDifficulty() {
        const difficulties = ['easy', 'medium', 'hard'];
        return difficulties[Math.floor(Math.random() * difficulties.length)];
    }

    createBoard();
</script>

</body>
</html>
