<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe AI</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #ecf0f1;
            --text-color: #34495e;
            --border-color: #bdc3c7;
            --disabled-color: #95a5a6;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--background-color);
            font-family: Arial, sans-serif;
            color: var(--text-color);
            user-select: none;
        }

        .container {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
        }

        h1 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 2rem;
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .cell {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            background-color: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cell:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .cell:active {
            transform: scale(0.95);
        }

        #difficulty {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        #result {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            min-height: 30px;
        }

        #resetButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #resetButton:hover:not(:disabled) {
            background-color: #2980b9;
        }

        #resetButton:disabled {
            background-color: var(--disabled-color);
            cursor: not-allowed;
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .cell {
                font-size: 2rem;
            }

            #difficulty, #result {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Tic-Tac-Toe AI</h1>
    <div id="difficulty">Difficulty: <span id="difficultyLevel"></span></div>
    <div id="gameBoard"></div>
    <div id="result"></div>
    <button id="resetButton">New Game</button>
</div>

<script>
    const board = [
        ['', '', ''],
        ['', '', ''],
        ['', '', '']
    ];
    let currentPlayer = 'X';
    let aiDifficulty = getRandomDifficulty();
    let gameActive = true;

    const gameBoard = document.getElementById('gameBoard');
    const resultDisplay = document.getElementById('result');
    const difficultyDisplay = document.getElementById('difficultyLevel');
    const resetButton = document.getElementById('resetButton');

    const androidInterfaceExists = typeof AndroidInterface !== 'undefined';

    function createBoard() {
        gameBoard.innerHTML = '';
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.addEventListener('click', handleCellClick);
                gameBoard.appendChild(cell);
            }
        }
        updateDifficultyDisplay();
        resetButton.disabled = false;
    }

    function updateDifficultyDisplay() {
        difficultyDisplay.textContent = aiDifficulty.charAt(0).toUpperCase() + aiDifficulty.slice(1);
    }

    function handleCellClick(event) {
        if (!gameActive) return;
        const row = parseInt(event.target.dataset.row);
        const col = parseInt(event.target.dataset.col);

        if (board[row][col] === '' && currentPlayer === 'X') {
            makeMove(row, col, 'X');
            resetButton.disabled = true;
            if (checkWin('X')) {
                endGame('You win!');
            } else if (checkTie()) {
                endGame('It\'s a tie!');
            } else {
                currentPlayer = 'O';
                setTimeout(aiMove, 500);
            }
        }
    }

    function makeMove(row, col, player) {
        board[row][col] = player;
        gameBoard.children[row * 3 + col].textContent = player;
    }

    function aiMove() {
        if (!gameActive) return;
        let move;
        if (aiDifficulty === 'easy') {
            move = randomMove();
        } else if (aiDifficulty === 'medium') {
            move = mediumMove();
        } else {
            move = bestMove();
        }

        if (move) {
            makeMove(move.row, move.col, 'O');
            if (checkWin('O')) {
                endGame('AI wins!');
            } else if (checkTie()) {
                endGame('It\'s a tie!');
            } else {
                currentPlayer = 'X';
            }
        }
    }

    function randomMove() {
        const availableMoves = getAvailableMoves();
        if (availableMoves.length > 0) {
            const randomIndex = Math.floor(Math.random() * availableMoves.length);
            return availableMoves[randomIndex];
        }
        return null;
    }

    function mediumMove() {
        // Try to win
        const winningMove = findWinningMove('O');
        if (winningMove) return winningMove;

        // Block player's winning move
        const blockingMove = findWinningMove('X');
        if (blockingMove) return blockingMove;

        // Make a random move
        return randomMove();
    }

    function bestMove() {
        let bestScore = -Infinity;
        let move;
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[i][j] === '') {
                    board[i][j] = 'O';
                    let score = minimax(board, 0, false);
                    board[i][j] = '';
                    if (score > bestScore) {
                        bestScore = score;
                        move = { row: i, col: j };
                    }
                }
            }
        }
        return move;
    }

    function minimax(board, depth, isMaximizing) {
        if (checkWin('O')) return 10 - depth;
        if (checkWin('X')) return depth - 10;
        if (checkTie()) return 0;

        if (isMaximizing) {
            let bestScore = -Infinity;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i][j] === '') {
                        board[i][j] = 'O';
                        let score = minimax(board, depth + 1, false);
                        board[i][j] = '';
                        bestScore = Math.max(score, bestScore);
                    }
                }
            }
            return bestScore;
        } else {
            let bestScore = Infinity;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i][j] === '') {
                        board[i][j] = 'X';
                        let score = minimax(board, depth + 1, true);
                        board[i][j] = '';
                        bestScore = Math.min(score, bestScore);
                    }
                }
            }
            return bestScore;
        }
    }

    function findWinningMove(player) {
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[i][j] === '') {
                    board[i][j] = player;
                    if (checkWin(player)) {
                        board[i][j] = '';
                        return { row: i, col: j };
                    }
                    board[i][j] = '';
                }
            }
        }
        return null;
    }

    function getAvailableMoves() {
        const moves = [];
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[i][j] === '') {
                    moves.push({ row: i, col: j });
                }
            }
        }
        return moves;
    }

    function checkWin(player) {
        for (let i = 0; i < 3; i++) {
            if (board[i][0] === player && board[i][1] === player && board[i][2] === player) return true;
            if (board[0][i] === player && board[1][i] === player && board[2][i] === player) return true;
        }
        if (board[0][0] === player && board[1][1] === player && board[2][2] === player) return true;
        if (board[0][2] === player && board[1][1] === player && board[2][0] === player) return true;
        return false;
    }

    function checkTie() {
        return board.flat().every(cell => cell !== '');
    }

    function endGame(message) {
        gameActive = false;
        resultDisplay.textContent = message;
        resetButton.disabled = false;
        if (androidInterfaceExists) {
            AndroidInterface.onGameOver("Tic-Tac-Toe: " + message);
        }
    }

    function resetGame() {
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                board[i][j] = '';
                gameBoard.children[i * 3 + j].textContent = '';
            }
        }
        currentPlayer = 'X';
        aiDifficulty = getRandomDifficulty();
        gameActive = true;
        resultDisplay.textContent = '';
        updateDifficultyDisplay();
        resetButton.disabled = false;
    }

    function getRandomDifficulty() {
        const difficulties = ['easy', 'medium', 'hard'];
        return difficulties[Math.floor(Math.random() * difficulties.length)];
    }

    resetButton.addEventListener('click', resetGame);
    createBoard();
</script>

</body>
</html>